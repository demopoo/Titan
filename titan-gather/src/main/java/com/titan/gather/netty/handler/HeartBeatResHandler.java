package com.titan.gather.netty.handler;import com.google.protobuf.Any;import com.titan.gather.constant.MessageTypeConstants;import com.titan.gather.model.message.Header;import com.titan.gather.model.message.TitanMessage;import io.netty.channel.ChannelHandlerAdapter;import io.netty.channel.ChannelHandlerContext;/** * @author: yupu * @Date: Created in 下午3:39 2018/11/5 * @Des:  服务端心跳应答 * @Modifyed By: */public class HeartBeatResHandler extends ChannelHandlerAdapter {    @Override    public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {        TitanMessage.titan_message message = (TitanMessage.titan_message)msg;        Header.header header = message.getHeader().unpack(Header.header.class);        if (header != null && header.getType() == MessageTypeConstants.HEART_BEAT_REQ){            Any any = message.getBody();            if (!any.getValue().isEmpty()){                ctx.close();            }else {                System.out.println("收到心跳");                ctx.writeAndFlush(buildHeartBeatMessage());            }        }else {            ctx.fireChannelRead(msg);        }    }    public TitanMessage.titan_message buildHeartBeatMessage(){        TitanMessage.titan_message.Builder message = TitanMessage.titan_message.newBuilder();        Header.header.Builder header = Header.header.newBuilder();        header.setCrcCode(0xabef0101);        header.setType(MessageTypeConstants.HEART_BEAT_RES);        message.setHeader(Any.pack(header.build()));        return message.build();    }}